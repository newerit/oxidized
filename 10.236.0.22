#        routerboard: yes
#              model: 2011UiAS
#           revision: r2
#      serial-number: 8C1A0905A0A6
#      firmware-type: ar9344
#   factory-firmware: 3.41
#   current-firmware: 3.41
#   upgrade-firmware: 6.43.16
# 
#             channel: stable
#   installed-version: 6.43.16
# 
# Flags: U - undoable, R - redoable, F - floating-undo 
#   ACTION                                   BY               POLICY             
# U dns changed                              cassio           write              
# U new script added                         cassio           write              
# U new script scheduled                     cassio           write              
# U changed email settings                   cassio           write              
# U device changed                           cassio           write              
# U system identity changed                  noc              write              
# U device changed                           cassio           write              
# U device changed                           cassio           write              
# U device changed                           cassio           write              
# U device changed                           cassio           write              
# U device changed                           cassio           write              
# U device changed                           cassio           write              
# U device changed                           cassio           write              
# U device changed                           cassio           write              
# U device changed                           cassio           write              
# U device changed                           cassio           write              
# U device changed                           cassio           write              
# 
# software id = VNII-IC7T
#
# model = 2011UiAS
# serial number = 8C1A0905A0A6
/interface bridge
add name=bridge_geral protocol-mode=none
/interface ethernet
set [ find default-name=ether2 ] comment=VMWARE speed=100Mbps
set [ find default-name=ether3 ] comment=PROXMOX
set [ find default-name=sfp1 ] auto-negotiation=no name="sfp1-UP LINK"
/interface wireless security-profiles
set [ find default=yes ] supplicant-identity=MikroTik
/snmp community
set [ find default=yes ] name=neweritmk
/system logging action
set 0 memory-lines=100
set 1 disk-lines-per-file=100
add bsd-syslog=yes name=newerit remote=177.66.65.102 target=remote
/interface bridge port
add bridge=bridge_geral interface="sfp1-UP LINK"
add bridge=bridge_geral interface=ether1
add bridge=bridge_geral interface=ether2
add bridge=bridge_geral interface=ether3
add bridge=bridge_geral interface=ether4
add bridge=bridge_geral interface=ether5
add bridge=bridge_geral interface=ether6
add bridge=bridge_geral interface=ether7
add bridge=bridge_geral interface=ether9
add bridge=bridge_geral interface=ether10
add bridge=bridge_geral interface=ether8
/ip firewall connection tracking
set enabled=no
/ip address
add address=10.236.0.22/30 interface="sfp1-UP LINK" network=10.236.0.20
/ip dns
set servers=45.236.180.10,1.1.1.1
/ip route
add distance=1 gateway=10.236.0.21
/snmp
set contact=suporte@newerit.com enabled=yes location=RB_SERVIDORES trap-version=2
/system clock
set time-zone-name=America/Campo_Grande
/system identity
set name=10126-SPEEDNETCR-RBSERV
/system logging
add action=newerit topics=account,info
/system note
set note="                            +-++-++-++-++-+ +-++-+\n                            |N||e||w||e||r| |I||T|\n                            +-++-++-++-++-+ +-++-+\n                            ++++|newerit.com|+++++\n                            +|contato@newerit.com|"
/system ntp client
set enabled=yes primary-ntp=200.160.0.8 secondary-ntp=200.189.40.8
/system scheduler
add interval=1d name=NEWERIT_BKPF on-event=NEWERIT_BKPF policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon start-date=apr/09/2019 start-time=04:31:33
add interval=2d name=NEWERIT_BKPFR on-event="/file remove [find]" policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon start-date=apr/09/2019 start-time=05:08:37
add interval=1d name=Backup_Email_SpeednetCR on-event=Backup_Email_SpeednetCR policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon start-date=oct/14/2019 start-time=13:21:37
/system script
add dont-require-permissions=no name=NEWERIT_BKPF owner=flavio policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source=":local saveSysBackup true\r\n:local encryptSysBackup false\r\n:local saveRawExport true\r\n\r\n:local FTPServer \"newerit.com\"\r\n:local FTPPort 21\r\n:local FTPUser \"nwftp@newerit.com\"\r\n:local FTPPass \"*********\"\r\n\r\n\r\n:local ts [/system clock get time]\r\n:set ts ([:pick \$ts 0 2].[:pick \$ts 3 5].[:pick \$ts 6 8])\r\n:local ds [/system clock get date]\r\n:set ds ([:pick \$ds 7 11].[:pick \$ds 0 3].[:pick \$ds 4 6])\r\n\r\n:local fname ([/system identity get name].\"-\".\$ds.\"-\".\$ts )\r\n:local sfname (\"/\".\$fname)\r\n:if (\$saveSysBackup) do={\r\n  :if (\$encryptSysBackup = true) do={ /system backup save name=(\$sfname.\".backup\") }\r\n  :if (\$encryptSysBackup = false) do={ /system backup save dont-encrypt=yes name=(\$sfname.\".backup\") }\r\n  :log info message=\"System Backup Finished\"\r\n}\r\nif (\$saveRawExport) do={\r\n  /export file=(\$sfname.\".rsc\")\r\n  :log info message=\"Raw configuration script export Finished\"\r\n}\r\n:local backupFileName \"\"\r\n:foreach backupFile in=[/file find] do={\r\n  :set backupFileName (\"/\".[/file get \$backupFile name])\r\n  :if ([:typeof [:find \$backupFileName \$sfname]] != \"nil\") do={\r\n    /tool fetch address=\$FTPServer port=\$FTPPort src-path=\$backupFileName user=\$FTPUser mode=ftp password=\$FTPPass dst-path=\$backupFileName upload=yes\r\n  }\r\n}\r\n:delay 5s\r\n\r\n:log info message=\"Arquivos temporarios de Backup removidos\"\r\n:log info message=\"Backup Enviado com Sucesso!\""
add dont-require-permissions=no name=Backup_Email_SpeednetCR owner=cassio policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source="/export file=backup_mikrotik compact\r\n:log info message=\"Iniciando Backup por E-mail\"\r\n:delay 5s\r\n:global data [/system clock get date]\r\n:global hora [/system clock get time]\r\n:global nome [/system identity get name]\r\n\r\n\r\n/tool e-mail send to=\"nocspeednetcr@gmail.com\" subject=\"Backup do MikroTik \$nome - \$data \E0s \$hora\" body=\"Backup automatico do servidor \$me realizado \E0s \$hora de \$data.\" file=backup_mikrotik start-tls=yes\r\n\r\n\r\n\r\n"
/tool e-mail
set address=smtp.gmail.com from=bkpspeednetcr@gmail.com password=speedcr1234 port=587 start-tls=yes user=bkpspeednetcr@gmail.com
